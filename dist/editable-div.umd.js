(function(t,a){typeof exports=="object"&&typeof module<"u"?module.exports=a(require("vue-demi")):typeof define=="function"&&define.amd?define(["vue-demi"],a):(t=typeof globalThis<"u"?globalThis:t||self,t["editable-div"]=a(t.VueDemi))})(this,function(t){"use strict";const a={canEdit:{type:Boolean,default:!0},limit:{type:Number,default:999999},content:{type:String,required:!0},renderHtml:{type:Boolean,default:!1},row:{type:Number,default:1},type:{type:String,default:"input"},autogrow:{type:Boolean,default:!1},wrapperClass:{type:String,default:"",required:!1}},b={resize:{resize:"vertical"},row:n=>({height:`${n}px`}),textarea:{overflowX:"hidden",overflowY:"auto"},autogrow:{height:"auto",whiteSpace:"wrap"},input:{overflowX:"auto",overflowY:"hidden",whiteSpace:"nowrap"},editableContainer:n=>({minHeight:`${n}px`,width:"180px",display:"block",padding:"5px 15px",lineHeight:"1.5",boxSizing:"border-box",fontSize:"inherit",color:"#606266",backgroundColor:"#ffffff",backgroundImage:"none",border:"1px solid #dcdfe6",borderRadius:"4px",transition:"border-color 0.2s cubic-bezier(0.645, 0.045, 0.355, 1)"})};return t.defineComponent({name:"EditableDiv",props:a,emit:{"update:content":n=>{},focus:n=>{}},setup(n,{emit:l}){const r=t.ref(!1),d=t.ref(!1),u=t.ref(""),s=t.ref(),{resize:v,row:w,textarea:x,autogrow:S,input:E,editableContainer:B}=b;console.log("isVue3: ",t.isVue2,t.isVue3);const p=40,h=t.computed(()=>{const e={...B(p)};return n.type==="textarea"?(Object.assign(e,{...v,...w(p),...x}),n.autogrow&&Object.assign(e,{...S})):Object.assign(e,{...E}),e}),y=e=>{var i;const o=(i=s.value)==null?void 0:i.textContent;r.value||(F(),o.length>=n.limit?(e.preventDefault(),f(o)):(l("update:content",o),u.value=o))},F=()=>{var e;n.type==="input"&&(s.value.scrollLeft=(e=s.value)==null?void 0:e.scrollWidth)},T=e=>{const o=document.createRange();o.selectNodeContents(e),o.collapse(!1);const i=window.getSelection();i.removeAllRanges(),i.addRange(o),d.value=!0},c=e=>{e.type==="compositionstart"?r.value=!0:e.type==="compositionend"&&(r.value=!1)},f=e=>{let o;if(n.renderHtml){let i=document.createElement("div");i.style.display="none",i.innerHTML=e,o=i.innerText.slice(0,n.limit),s.value.innerHTML=e,i=null}else o=e.slice(0,n.limit),s.value.innerText=o;u.value=o,l("update:content",o),T(s.value)},C=()=>{d.value=!0,l("focus",!0)},g=()=>{d.value=!1,l("focus",!1)};t.onMounted(()=>{t.nextTick(()=>{var e;console.log("editorContainer.value: ",s.value),(e=s.value)==null||e.addEventListener("paste",o=>{o.preventDefault();const i=o.clipboardData.getData("text/plain"),m=u.value+i;m.length>=n.limit?f(m):document.execCommand("insertText",!1,i)})})}),t.watch(()=>n.content,e=>{if(!d){if(r)return;f(e)}});const z=()=>t.h("div",{ref:"editorContainer",style:{...h.value},class:n.wrapperClass,contenteditable:n.canEdit,onFocus:C,onBlur:g,onKeyup:y,onCompositionstart:c,onCompositionend:c});return{...n,isVue3:t.isVue3,render:z,editorContainer:s,cssStyle:h,handleFocus:C,handleBlur:g,updateData:y,handleComposition:c}},render(){return t.h("div",this.isVue3?{ref:"editorContainer",style:{...this.cssStyle},class:this.wrapperClass,contentEditable:this.canEdit,onFocus:this.handleFocus,onBlur:this.handleBlur,onKeyup:this.updateData,onCompositionstart:this.handleComposition,onCompositionend:this.handleComposition}:{ref:"editorContainer",style:{...this.cssStyle},class:this.wrapperClass,attrs:{contentEditable:this.canEdit},onFocus:this.handleFocus,onBlur:this.handleBlur,onKeyup:this.updateData,onCompositionstart:this.handleComposition,onCompositionend:this.handleComposition})}})});
